---
begin: 2022-03-10
status: ongoing
rating: 1
---

# Zipkin Brave & Spring Cloud Sleuth 采样器源码分析

# 简介

引入分布式链路收集之后难免会有一定的开销，开销主要分为生成开销、收集开销。对于 Zipkin Brave 来说生成开销几乎是微不足道的，主要是在内存中创建一些链路上下文、跨度对象，且会增加微小的延时。但收集的开销就比较大，首先数据上报会占用业务系统一定的 CPU、内存、线程资源。然后数据落盘存储也会消耗一定的存储成本，对于互联网应用等数据量大且低延时要求高的系统来说影响是不可忽视的。
Dapper 论文中指出在 Google 在分布式链路追踪实际过程中，降低采样率是最直接也是收益最高的减少开销的方式，并且数据表明当时谷歌的量级，系统最微小的错误都会被无限放大，因此我们不用担心丢弃部分采样会让我们错过关键信息，谷歌实践过程中设置采样率为 1/1024 时就以及足够获得有用信息，并且开销也显著降低。

## 概念

首先采样决定了一条链路或者说一次请求是否需要采集。采样主要如下分为三种策略

- 前置采样
	- 思路

| 对比 | 前置采样 | 后置采样| 单元采样 | 
| :-- | :-- | :-- | :-- |
| 思路 | 链路开始的最初决定是否采样，一旦决定不采样，整个请求就不生成跨度信息，也不上报 |



## 参考链接


##### 标签
